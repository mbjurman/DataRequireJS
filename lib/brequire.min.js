function compile(e){if(this.constructor!=compile)return new compile(e);this.search_paths=["**.js"];this.src(e)}function join(){var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);return e.join("/").replace(/\/\//g,"/").replace(/\/$/,"")}function mkDirTree(e){var t=path.dirname(e).split("/");var n="",r;while((r=t.shift())!=null){n+=r;if(!path.existsSync(n)){fs.mkdirSync(n,509)}n+="/"}}function wrap(e,t){return"require.define('"+e+"', [], function(module, exports, require) {\n"+t+"\n}); // end module: "+e+"\n"}var fs=require("fs"),path=require("path"),glob=require("glob").globSync;compile.module=compile;compile.prototype.src=function(e){if(e.match(/^[\.~\\]/)){this._module_base="./";var t=path.resolve(e);if(fs.statSync(t).isFile()){this.root=path.dirname(t);this.search_paths=[path.basename(t)]}else{this.root=t}}else{this._module_base=e+"/";this.root=path.dirname(require.resolve(e))}return this};compile.prototype.search=function(){this.search_paths=Array.prototype.slice.call(arguments);return this};compile.prototype._files=function(){var e=[];for(var t=0;t<this.search_paths.length;t++){var n=path.join(this.root,this.search_paths[t]);var r=glob(n);e=e.concat(r)}var i=[];for(var t=0;t<e.length;t++){if(!fs.statSync(e[t]).isFile())continue;i.push(e[t].replace(this.root+"/",""))}return i};compile.prototype._modules=function(){var e=this._files(),t=[];for(var n=0;n<e.length;n++)t.push(join(this._module_base,e[n]));return t};compile.prototype.module_base=function(e){this._module_base=join(e,"/");return this};compile.prototype.inspect=function(){console.log({files:this._files(),module_base:this._module_base,search_paths:this.search_paths});return this};compile.prototype.write=function(e){if(!e)return this;var t=this._files();if(e.match(/\.js$/)){var n=this.toString();var r=e;mkDirTree(r);fs.writeFileSync(r,n)}else{for(var i=0;i<t.length;i++){var s=join(this._module_base,t[i]);var o=fs.readFileSync(join(this.root,t[i])).toString();if(t[i].match(/\.coffee$/)){o=(new(require("coffee-script"))).compile(o);s=s.replace(/\.coffee$/,".js");t[i]=t[i].replace(/\.coffee$/,".js")}var n=wrap(s,o);var u=join(e,t[i]);mkDirTree(u);fs.writeFileSync(u,n)}}return this};compile.prototype.toString=function(){var e="";var t=this._files();for(var n=0;n<t.length;n++){var r=join(this._module_base,t[n]);var i=fs.readFileSync(join(this.root,t[n])).toString();if(t[n].match(/\.coffee$/)){i=(new(require("coffee-script"))).compile(i);r=r.replace(/\.coffee$/,".js")}e+=wrap(r,i)+"\n"}return e};module.exports=compile;exports.wrap=wrap